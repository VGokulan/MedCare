{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Admin Dashboard</h2>

  <!-- Search + Filters -->
  <form method="get" class="row g-3 mb-4">
    <div class="col-md-3">
      <input type="text" name="search" class="form-control"
             placeholder="Search by Patient ID"
             value="{{ current_filters.search }}">
    </div>
    <div class="col-md-2">
      <select name="risk_level" class="form-select">
        <option value="">All Risk Levels</option>
        <option value="Low" {% if current_filters.risk_level == "Low" %}selected{% endif %}>Low</option>
        <option value="Medium" {% if current_filters.risk_level == "Medium" %}selected{% endif %}>Medium</option>
        <option value="High" {% if current_filters.risk_level == "High" %}selected{% endif %}>High</option>
      </select>
    </div>
    <div class="col-md-2">
      <select name="status" class="form-select">
        <option value="">All Status</option>
        <option value="Hospitalized" {% if current_filters.status == "Hospitalized" %}selected{% endif %}>Hospitalized</option>
        <option value="Not Hospitalized" {% if current_filters.status == "Not Hospitalized" %}selected{% endif %}>Not Hospitalized</option>
      </select>
    </div>
    <div class="col-md-2">
      <select name="age_range" class="form-select">
        <option value="">All Ages</option>
        <option value="0-40" {% if current_filters.age_range == "0-40" %}selected{% endif %}>0-40</option>
        <option value="41-60" {% if current_filters.age_range == "41-60" %}selected{% endif %}>41-60</option>
        <option value="61-80" {% if current_filters.age_range == "61-80" %}selected{% endif %}>61-80</option>
        <option value="80+" {% if current_filters.age_range == "80+" %}selected{% endif %}>80+</option>
      </select>
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-primary w-100">Filter</button>
    </div>
  </form>

  <!-- Patient Table -->
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>Patient ID</th>
          <th>Age</th>
          <th>Gender</th>
          <th>Risk Level</th>
          <th>30d Hospitalization Score</th>
          <th>Chronic Conditions</th>
          <th>Total Medicare Costs ($)</th>
        </tr>
      </thead>
      <tbody>
        {% for patient in patients %}
        <tr>
          <td>{{ patient.desynpuf_id }}</td>
          <td>{{ patient.age }}</td>
          <td>
            {% if patient.gender_male %}
              Male
            {% else %}
              Female
            {% endif %}
          </td>
          <td>
            <span class="badge 
              {% if patient.risk_tier_label == 'High' %} bg-danger 
              {% elif patient.risk_tier_label == 'Medium' %} bg-warning text-dark
              {% else %} bg-success {% endif %}">
              {{ patient.risk_tier_label }}
            </span>
          </td>
          <td>{{ patient.hospitalization_30d_score }}</td>
          <td>{{ patient.chronic_condition_count }}</td>
          <td>{{ patient.total_medicare_costs }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="text-center py-3">
            No patient data found in the database.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
